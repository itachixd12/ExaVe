<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - Pet Care</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 text-gray-800">
    <!-- Header -->
    <header class="bg-gradient-to-r from-red-600 to-orange-600 text-white shadow-lg">
        <div class="container mx-auto px-6 py-6">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">üîß Panel Administrativo - Pet Care</h1>
                <button onclick="logout()" class="px-4 py-2 bg-red-700 hover:bg-red-800 text-white rounded">
                    Cerrar sesi√≥n
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Tabs de navegaci√≥n -->
        <div class="flex gap-4 mb-8 border-b border-gray-300">
            <button class="px-6 py-3 border-b-2 border-orange-600 text-orange-600 font-semibold" onclick="cambiarTab('citas')">
                üìã Gestionar Citas
            </button>
            <button class="px-6 py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-800" onclick="cambiarTab('servicios')">
                üè• Servicios
            </button>
            <button class="px-6 py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-800" onclick="cambiarTab('veterinarios')">
                üë®‚Äç‚öïÔ∏è Veterinarios
            </button>
        </div>

        <!-- Tab Citas -->
        <div id="tab-citas">
            <h2 class="text-3xl font-bold mb-8 text-gray-800">Gestionar Citas</h2>

            <!-- Filtros -->
            <div class="mb-6 flex gap-4">
                <button class="px-4 py-2 rounded-lg border-2 border-orange-600 text-orange-600 font-semibold hover:bg-orange-50" onclick="filtrarCitasAdmin('todas')">
                    Todas
                </button>
                <button class="px-4 py-2 rounded-lg border-2 border-gray-300 text-gray-600 hover:bg-gray-100" onclick="filtrarCitasAdmin('pendiente')">
                    Pendientes
                </button>
                <button class="px-4 py-2 rounded-lg border-2 border-gray-300 text-gray-600 hover:bg-gray-100" onclick="filtrarCitasAdmin('confirmada')">
                    Confirmadas
                </button>
                <button class="px-4 py-2 rounded-lg border-2 border-gray-300 text-gray-600 hover:bg-gray-100" onclick="filtrarCitasAdmin('completada')">
                    Completadas
                </button>
            </div>

            <!-- Lista de citas -->
            <div id="citas-admin-container" class="space-y-4">
                <!-- Las citas se cargar√°n aqu√≠ -->
            </div>
        </div>

        <!-- Tab Servicios -->
        <div id="tab-servicios" class="hidden">
            <h2 class="text-3xl font-bold mb-8 text-gray-800">Gestionar Servicios</h2>

            <button onclick="mostrarModalServicio()" class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 mb-6">
                + Nuevo Servicio
            </button>

            <div id="servicios-admin-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Los servicios se cargar√°n aqu√≠ -->
            </div>
        </div>

        <!-- Tab Veterinarios -->
        <div id="tab-veterinarios" class="hidden">
            <h2 class="text-3xl font-bold mb-8 text-gray-800">Gestionar Veterinarios</h2>

            <button onclick="mostrarModalVeterinario()" class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 mb-6">
                + Nuevo Veterinario
            </button>

            <div id="veterinarios-admin-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Los veterinarios se cargar√°n aqu√≠ -->
            </div>
        </div>
    </div>

    <!-- Modal Aceptar Cita -->
    <div id="modal-aceptar-cita" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Aceptar Cita</h3>

            <form id="form-aceptar-cita" class="space-y-4">
                <input type="hidden" id="cita-id-aceptar" />
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Asignar Veterinario</label>
                    <select id="veterinario-select" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                        <option value="">Selecciona un veterinario...</option>
                    </select>
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">
                        Confirmar
                    </button>
                    <button type="button" onclick="cerrarModalAceptarCita()" class="flex-1 px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 font-semibold">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Rechazar Cita -->
    <div id="modal-rechazar-cita" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Rechazar Cita</h3>

            <form id="form-rechazar-cita" class="space-y-4">
                <input type="hidden" id="cita-id-rechazar" />
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Raz√≥n del rechazo</label>
                    <textarea id="razon-rechazo" required rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"></textarea>
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold">
                        Rechazar
                    </button>
                    <button type="button" onclick="cerrarModalRechazarCita()" class="flex-1 px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 font-semibold">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Nuevo Servicio -->
    <div id="modal-servicio" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Nuevo Servicio</h3>

            <form id="form-servicio" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nombre</label>
                    <input type="text" id="servicio-nombre" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" />
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Tipo</label>
                    <select id="servicio-tipo" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                        <option value="">Selecciona el tipo</option>
                        <option value="consulta">Consulta General</option>
                        <option value="vacuna">Vacunas</option>
                        <option value="bano">Ba√±os</option>
                        <option value="cirugia">Cirug√≠as</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Descripci√≥n</label>
                    <textarea id="servicio-descripcion" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Precio ($)</label>
                    <input type="number" id="servicio-precio" required step="0.01" min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" />
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Duraci√≥n (minutos)</label>
                    <input type="number" id="servicio-duracion" required min="15" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" />
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-semibold">
                        Guardar
                    </button>
                    <button type="button" onclick="cerrarModalServicio()" class="flex-1 px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 font-semibold">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Nuevo Veterinario -->
    <div id="modal-veterinario" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Nuevo Veterinario</h3>

            <form id="form-veterinario" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nombre</label>
                    <input type="text" id="vet-nombre" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" />
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Email</label>
                    <input type="email" id="vet-email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" />
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Tel√©fono</label>
                    <input type="tel" id="vet-telefono" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" />
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Especialidad</label>
                    <input type="text" id="vet-especialidad" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" />
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">N√∫mero de Licencia</label>
                    <input type="text" id="vet-licencia" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" />
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-semibold">
                        Guardar
                    </button>
                    <button type="button" onclick="cerrarModalVeterinario()" class="flex-1 px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 font-semibold">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000/api';
        const token = localStorage.getItem('authToken');
        const rol = localStorage.getItem('rol');
        let todasLasCitas = [];
        let filtroActualCitas = 'todas';

        // Verificar que es admin
        if (rol !== 'admin') {
            alert('No tienes permisos para acceder a este panel');
            window.location.href = 'index-veterinaria.html';
        }

        document.addEventListener('DOMContentLoaded', function () {
            cargarCitasAdmin();
            cargarServiciosAdmin();
            cargarVeterinarios();

            // Formularios
            document.getElementById('form-aceptar-cita').addEventListener('submit', aceptarCita);
            document.getElementById('form-rechazar-cita').addEventListener('submit', rechazarCita);
            document.getElementById('form-servicio').addEventListener('submit', guardarServicio);
            document.getElementById('form-veterinario').addEventListener('submit', guardarVeterinario);
        });

        // ============ CITAS ============

        async function cargarCitasAdmin() {
            try {
                const response = await fetch(`${API_URL}/citas`, {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                todasLasCitas = await response.json();
                mostrarCitasAdmin();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function cambiarTab(tab) {
            document.querySelectorAll('[id^="tab-"]').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tab}`).classList.remove('hidden');

            document.querySelectorAll('header + div button').forEach(btn => {
                btn.classList.remove('border-orange-600', 'text-orange-600', 'border-b-2');
                btn.classList.add('border-b-2', 'border-transparent');
            });
            event.target.classList.add('border-orange-600', 'text-orange-600');
        }

        function filtrarCitasAdmin(filtro) {
            filtroActualCitas = filtro;
            mostrarCitasAdmin();
        }

        function mostrarCitasAdmin() {
            const container = document.getElementById('citas-admin-container');
            let citasAMostrar = todasLasCitas;

            if (filtroActualCitas !== 'todas') {
                citasAMostrar = todasLasCitas.filter(cita => cita.estado === filtroActualCitas);
            }

            container.innerHTML = '';

            citasAMostrar.forEach(cita => {
                const estadoColores = {
                    'pendiente': 'bg-yellow-100 border-yellow-300',
                    'confirmada': 'bg-blue-100 border-blue-300',
                    'completada': 'bg-green-100 border-green-300',
                    'rechazada': 'bg-red-100 border-red-300'
                };

                const html = `
                    <div class="bg-white rounded-lg shadow p-6 border-l-4 border-orange-600 ${estadoColores[cita.estado]}">
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-gray-600">Mascota</p>
                                <p class="font-bold">${cita.mascota.nombre}</p>
                                <p class="text-sm">${cita.mascota.especie}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Servicio</p>
                                <p class="font-bold">${cita.servicio.nombre}</p>
                                <p class="text-sm">$${parseFloat(cita.servicio.precio).toFixed(2)}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Fecha y Hora</p>
                                <p class="font-bold">${formatearFecha(cita.fecha)}</p>
                                <p class="text-sm">${cita.hora}</p>
                            </div>
                        </div>

                        <div class="mb-4">
                            <p class="text-sm text-gray-600">Cliente</p>
                            <p class="font-bold">${cita.user.name}</p>
                            <p class="text-sm">${cita.user.email}</p>
                        </div>

                        ${cita.veterinario ? `
                            <div class="mb-4 p-2 bg-blue-50 rounded">
                                <p class="text-sm text-gray-600">Veterinario Asignado</p>
                                <p class="font-bold">${cita.veterinario.nombre}</p>
                            </div>
                        ` : ''}

                        ${cita.observaciones ? `
                            <div class="mb-4 p-2 bg-gray-100 rounded">
                                <p class="text-sm font-semibold">Observaciones:</p>
                                <p class="text-sm">${cita.observaciones}</p>
                            </div>
                        ` : ''}

                        <div class="flex gap-2">
                            ${cita.estado === 'pendiente' ? `
                                <button onclick="mostrarModalAceptarCita(${cita.id})" class="flex-1 px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm">
                                    Aceptar
                                </button>
                                <button onclick="mostrarModalRechazarCita(${cita.id})" class="flex-1 px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm">
                                    Rechazar
                                </button>
                            ` : (cita.estado === 'confirmada' ? `
                                <button onclick="completarCita(${cita.id})" class="flex-1 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                                    Marcar Completada
                                </button>
                            ` : '')}
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        function mostrarModalAceptarCita(citaId) {
            document.getElementById('cita-id-aceptar').value = citaId;
            document.getElementById('modal-aceptar-cita').classList.remove('hidden');
            cargarVeterinariosSelect();
        }

        function cerrarModalAceptarCita() {
            document.getElementById('modal-aceptar-cita').classList.add('hidden');
        }

        function mostrarModalRechazarCita(citaId) {
            document.getElementById('cita-id-rechazar').value = citaId;
            document.getElementById('modal-rechazar-cita').classList.remove('hidden');
        }

        function cerrarModalRechazarCita() {
            document.getElementById('modal-rechazar-cita').classList.add('hidden');
        }

        async function cargarVeterinariosSelect() {
            try {
                const response = await fetch(`${API_URL}/veterinarios`, {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                const veterinarios = await response.json();

                const select = document.getElementById('veterinario-select');
                select.innerHTML = '<option value="">Selecciona un veterinario...</option>';

                veterinarios.forEach(vet => {
                    const option = document.createElement('option');
                    option.value = vet.id;
                    option.textContent = `${vet.nombre} ${vet.especialidad ? '(' + vet.especialidad + ')' : ''}`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function aceptarCita(e) {
            e.preventDefault();

            const citaId = document.getElementById('cita-id-aceptar').value;
            const veterinarioId = document.getElementById('veterinario-select').value;

            try {
                const response = await fetch(`${API_URL}/citas/${citaId}/aceptar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ veterinario_id: veterinarioId })
                });

                if (response.ok) {
                    cerrarModalAceptarCita();
                    cargarCitasAdmin();
                    alert('Cita aceptada exitosamente');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function rechazarCita(e) {
            e.preventDefault();

            const citaId = document.getElementById('cita-id-rechazar').value;
            const razon = document.getElementById('razon-rechazo').value;

            try {
                const response = await fetch(`${API_URL}/citas/${citaId}/rechazar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ razon_rechazo: razon })
                });

                if (response.ok) {
                    cerrarModalRechazarCita();
                    cargarCitasAdmin();
                    alert('Cita rechazada');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function completarCita(citaId) {
            try {
                const response = await fetch(`${API_URL}/citas/${citaId}/completar`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });

                if (response.ok) {
                    cargarCitasAdmin();
                    alert('Cita marcada como completada');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // ============ SERVICIOS ============

        async function cargarServiciosAdmin() {
            try {
                const response = await fetch(`${API_URL}/servicios`);
                const servicios = await response.json();

                const container = document.getElementById('servicios-admin-container');
                container.innerHTML = '';

                servicios.forEach(servicio => {
                    const tipoTexto = {
                        'consulta': 'Consulta',
                        'vacuna': 'Vacuna',
                        'bano': 'Ba√±o',
                        'cirugia': 'Cirug√≠a'
                    };

                    const html = `
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${servicio.nombre}</h3>
                            <p class="text-sm text-gray-600 mb-3">${tipoTexto[servicio.tipo]}</p>
                            <p class="text-gray-600 text-sm mb-3">${servicio.descripcion || ''}</p>
                            <div class="flex justify-between items-center mb-4">
                                <div>
                                    <p class="text-sm text-gray-600">Precio: <span class="font-bold">$${parseFloat(servicio.precio).toFixed(2)}</span></p>
                                    <p class="text-sm text-gray-600">Duraci√≥n: <span class="font-bold">${servicio.duracion} min</span></p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editarServicio(${servicio.id})" class="flex-1 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                                    Editar
                                </button>
                                <button onclick="eliminarServicio(${servicio.id})" class="flex-1 px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm">
                                    Eliminar
                                </button>
                            </div>
                        </div>
                    `;
                    container.innerHTML += html;
                });
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function mostrarModalServicio() {
            document.getElementById('form-servicio').reset();
            document.getElementById('modal-servicio').classList.remove('hidden');
        }

        function cerrarModalServicio() {
            document.getElementById('modal-servicio').classList.add('hidden');
        }

        async function guardarServicio(e) {
            e.preventDefault();

            const datos = {
                nombre: document.getElementById('servicio-nombre').value,
                tipo: document.getElementById('servicio-tipo').value,
                descripcion: document.getElementById('servicio-descripcion').value,
                precio: parseFloat(document.getElementById('servicio-precio').value),
                duracion: parseInt(document.getElementById('servicio-duracion').value)
            };

            try {
                const response = await fetch(`${API_URL}/servicios`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify(datos)
                });

                if (response.ok) {
                    cerrarModalServicio();
                    cargarServiciosAdmin();
                    alert('Servicio creado exitosamente');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function eliminarServicio(servicioId) {
            if (confirm('¬øDeseas eliminar este servicio?')) {
                try {
                    const response = await fetch(`${API_URL}/servicios/${servicioId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': 'Bearer ' + token
                        }
                    });

                    if (response.ok) {
                        cargarServiciosAdmin();
                        alert('Servicio eliminado');
                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            }
        }

        // ============ VETERINARIOS ============

        async function cargarVeterinarios() {
            try {
                const response = await fetch(`${API_URL}/veterinarios`, {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                const veterinarios = await response.json();

                const container = document.getElementById('veterinarios-admin-container');
                container.innerHTML = '';

                veterinarios.forEach(vet => {
                    const html = `
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${vet.nombre}</h3>
                            <div class="space-y-1 text-sm text-gray-600 mb-4">
                                <p><span class="font-semibold">Email:</span> ${vet.email}</p>
                                <p><span class="font-semibold">Tel√©fono:</span> ${vet.telefono || 'No especificado'}</p>
                                <p><span class="font-semibold">Especialidad:</span> ${vet.especialidad || 'General'}</p>
                                <p><span class="font-semibold">Licencia:</span> ${vet.licencia}</p>
                            </div>
                            <div class="flex gap-2">
                                <button class="flex-1 px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm" onclick="eliminarVeterinario(${vet.id})">
                                    Eliminar
                                </button>
                            </div>
                        </div>
                    `;
                    container.innerHTML += html;
                });
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function mostrarModalVeterinario() {
            document.getElementById('form-veterinario').reset();
            document.getElementById('modal-veterinario').classList.remove('hidden');
        }

        function cerrarModalVeterinario() {
            document.getElementById('modal-veterinario').classList.add('hidden');
        }

        async function guardarVeterinario(e) {
            e.preventDefault();

            const datos = {
                nombre: document.getElementById('vet-nombre').value,
                email: document.getElementById('vet-email').value,
                telefono: document.getElementById('vet-telefono').value,
                especialidad: document.getElementById('vet-especialidad').value,
                licencia: document.getElementById('vet-licencia').value
            };

            try {
                const response = await fetch(`${API_URL}/veterinarios`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify(datos)
                });

                if (response.ok) {
                    cerrarModalVeterinario();
                    cargarVeterinarios();
                    alert('Veterinario creado exitosamente');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function eliminarVeterinario(veterinarioId) {
            if (confirm('¬øDeseas eliminar este veterinario?')) {
                try {
                    const response = await fetch(`${API_URL}/veterinarios/${veterinarioId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': 'Bearer ' + token
                        }
                    });

                    if (response.ok) {
                        cargarVeterinarios();
                        alert('Veterinario eliminado');
                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            }
        }

        function formatearFecha(fecha) {
            const date = new Date(fecha + 'T00:00:00');
            return date.toLocaleDateString('es-ES', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
        }

        function logout() {
            fetch(`${API_URL}/logout`, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            }).finally(() => {
                localStorage.removeItem('authToken');
                localStorage.removeItem('rol');
                window.location.href = 'index-veterinaria.html';
            });
        }
    </script>
</body>

</html>
